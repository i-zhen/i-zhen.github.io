<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>OCaml开发环境搭建 | Z.Y. ☯ Cosmos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="去年之前撰文 Haskell开发环境搭建，并且更新了对于VS Code的配置。虽然个人对Vim对使用时间更长，但是对于函数式语言对开发来说，还是觉得Emacs更好上手，特别是交互式开发模式。这一点不论Haskell还是Ocaml都是一样的。">
<meta property="og:type" content="article">
<meta property="og:title" content="OCaml开发环境搭建">
<meta property="og:url" content="https://izhen.me/2019/05/11/ocaml_config/index.html">
<meta property="og:site_name" content="Z.Y. ☯ Cosmos">
<meta property="og:description" content="去年之前撰文 Haskell开发环境搭建，并且更新了对于VS Code的配置。虽然个人对Vim对使用时间更长，但是对于函数式语言对开发来说，还是觉得Emacs更好上手，特别是交互式开发模式。这一点不论Haskell还是Ocaml都是一样的。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://izhen.me/image/imandra.jpg">
<meta property="og:image" content="https://izhen.me/image/ocaml_utop.jpg">
<meta property="og:image" content="https://izhen.me/image/ocaml_vim.jpg">
<meta property="article:published_time" content="2019-05-11T14:51:45.000Z">
<meta property="article:modified_time" content="2021-03-31T03:38:02.021Z">
<meta property="article:author" content="Zhen Yi">
<meta property="article:tag" content="Vim">
<meta property="article:tag" content="Emacs">
<meta property="article:tag" content="VS Code">
<meta property="article:tag" content="Mac OS X">
<meta property="article:tag" content="IDE">
<meta property="article:tag" content="OCaml">
<meta property="article:tag" content="imandra">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://izhen.me/image/imandra.jpg">
<meta name="twitter:creator" content="@soczhenyi">
  
    <link rel="alternate" href="/atom.xml" title="Z.Y. ☯ Cosmos" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Z.Y. ☯ Cosmos</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Powered by Disqus, scientific surfing for access</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="http://sweetpotato.ai">λ</a>
        
          <a class="main-nav-link" href="/lab">About</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://resume.izhen.me">Resume</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/i-zhen">Github</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://izhen.me"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ocaml_config" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/11/ocaml_config/" class="article-date">
  <time class="dt-published" datetime="2019-05-11T14:51:45.000Z" itemprop="datePublished">2019-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Blog/">Blog</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      OCaml开发环境搭建
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>去年之前撰文 <a href="https://izhen.me/2018/08/10/haskell_emacs/">Haskell开发环境搭建</a>，并且更新了对于<code>VS Code</code>的配置。虽然个人对<code>Vim</code>对使用时间更长，但是对于函数式语言对开发来说，还是觉得<code>Emacs</code>更好上手，特别是交互式开发模式。这一点不论Haskell还是Ocaml都是一样的。</p>
<span id="more"></span>

<h3 id="Emacs-for-OCaml"><a href="#Emacs-for-OCaml" class="headerlink" title="Emacs for OCaml"></a>Emacs for OCaml</h3><p>因为有了Haskell的配置经验，而OCaml的开发环境比Haskell简单不少，所以这里不做太多长篇大论的描述，主要配置参考了<a target="_blank" rel="noopener" href="https://dev.realworldocaml.org/install.html">Real World OCaml</a>。</p>
<h3 id="完整的配置文档"><a href="#完整的配置文档" class="headerlink" title="完整的配置文档"></a>完整的配置文档</h3><p>先装依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brew install opam libx11</span><br><span class="line">$ opam install core utop</span><br><span class="line">$ opam install async yojson core_extended core_bench cohttp async_graphics cryptokit menhir</span><br><span class="line">$ opam install merlin ocp-indent</span><br></pre></td></tr></table></figure>

<p>而后是完整文档，完整快捷键配置需参考注释，常用如下：</p>
<ul>
<li><code>C-c C-s</code> 打开Ocaml Utop</li>
<li><code>C-x C-e</code> 执行当前代码</li>
<li><code>C-x C-r</code> 执行当前选中区域</li>
<li><code>C-x C-b</code> 执行当前buffer</li>
<li><code>C-c C-k</code> 杀掉utop</li>
<li><code>C-c C-t</code> 显示光标所在位置的类型</li>
<li><code>C-c C-l</code> 去到定义处</li>
<li><code>C-c &lt;left&gt;</code> 类型展开/收缩</li>
<li><code>C-c &lt;right&gt;</code> 类型展开/收缩</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; install OCaml support</span></span><br><span class="line">(<span class="name">package-install</span> &#x27;tuareg)</span><br><span class="line">(<span class="name">package-install</span> &#x27;utop)</span><br><span class="line">(<span class="name">package-install</span> &#x27;merlin)</span><br><span class="line">(<span class="name">package-install</span> &#x27;auto-complete)</span><br><span class="line"></span><br><span class="line">(<span class="name">add-hook</span> &#x27;tuareg-mode-hook &#x27;tuareg-imenu-set-imenu)</span><br><span class="line">(<span class="name">setq</span> auto-mode-alist</span><br><span class="line">      (<span class="name">append</span> &#x27;((<span class="string">&quot;\\.ml[ily]?$&quot;</span> . tuareg-mode)</span><br><span class="line">                (<span class="string">&quot;\\.topml$&quot;</span> . tuareg-mode))</span><br><span class="line">              auto-mode-alist))</span><br><span class="line">(<span class="name">autoload</span> &#x27;utop-setup-ocaml-buffer <span class="string">&quot;utop&quot;</span> <span class="string">&quot;Toplevel for OCaml&quot;</span> <span class="literal">t</span>)</span><br><span class="line">(<span class="name">add-hook</span> &#x27;tuareg-mode-hook &#x27;utop-setup-ocaml-buffer)</span><br><span class="line">(<span class="name">add-hook</span> &#x27;tuareg-mode-hook &#x27;merlin-mode)</span><br><span class="line">(<span class="name">setq</span> merlin-use-auto-complete-mode <span class="literal">t</span>)</span><br><span class="line">(<span class="name">setq</span> merlin-error-after-save <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; -- merlin setup ---------------------------------------</span></span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> opam-share (<span class="name">substring</span> (<span class="name">shell-command-to-string</span> <span class="string">&quot;opam config var share&quot;</span>) <span class="number">0</span> <span class="number">-1</span>))</span><br><span class="line">(<span class="name">add-to-list</span> &#x27;load-path (<span class="name">concat</span> opam-share <span class="string">&quot;/emacs/site-lisp&quot;</span>))</span><br><span class="line">(<span class="name">require</span> &#x27;merlin)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Enable Merlin for ML buffers</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;tuareg-mode-hook &#x27;merlin-mode)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; So you can do it on a mac, where `C-&lt;up&gt;` and `C-&lt;down&gt;` are used</span></span><br><span class="line"><span class="comment">;; by spaces.</span></span><br><span class="line">(<span class="name">define-key</span> merlin-mode-map</span><br><span class="line">  (<span class="name">kbd</span> <span class="string">&quot;C-c &lt;left&gt;&quot;</span>) &#x27;merlin-type-enclosing-go-up)</span><br><span class="line">(<span class="name">define-key</span> merlin-mode-map</span><br><span class="line">  (<span class="name">kbd</span> <span class="string">&quot;C-c &lt;right&gt;&quot;</span>) &#x27;merlin-type-enclosing-go-down)</span><br><span class="line">(<span class="name">set-face-background</span> &#x27;merlin-type-face <span class="string">&quot;#88FF44&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; -- enable auto-complete -------------------------------</span></span><br><span class="line"><span class="comment">;; Not required, but useful along with merlin-mode</span></span><br><span class="line">(<span class="name">require</span> &#x27;auto-complete)</span><br><span class="line">(<span class="name">add-hook</span> &#x27;tuareg-mode-hook &#x27;auto-complete-mode)</span><br><span class="line">(<span class="name">setq</span> merlin-ac-setup &#x27;t)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Replace tuareg by ocp-indent</span></span><br><span class="line">(<span class="name">setq</span> opam-share (<span class="name">substring</span> (<span class="name">shell-command-to-string</span> <span class="string">&quot;opam config var share&quot;</span>) <span class="number">0</span> <span class="number">-1</span>))</span><br><span class="line">(<span class="name">load-file</span> (<span class="name">concat</span> opam-share <span class="string">&quot;/emacs/site-lisp/ocp-indent.el&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Vim-for-OCaml"><a href="#Vim-for-OCaml" class="headerlink" title="Vim for OCaml"></a>Vim for OCaml</h3><p>Vim中的配置如下，主要依赖Omni和Merlin这个神器：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot; Vim needs to be built with Python scripting support, and must be</span></span><br><span class="line"><span class="comment">&quot; able to find Merlin&#x27;s executable on PATH.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">executable</span>(<span class="string">&#x27;ocamlmerlin&#x27;</span>) &amp;&amp; <span class="built_in">has</span>(<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">s:ocamlmerlin</span> = <span class="keyword">substitute</span>(<span class="built_in">system</span>(<span class="string">&#x27;opam config var share&#x27;</span>), <span class="string">&#x27;\n$&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span>) . <span class="string">&quot;/merlin&quot;</span></span><br><span class="line">  <span class="keyword">execute</span> <span class="string">&quot;set rtp+=&quot;</span>.<span class="variable">s:ocamlmerlin</span>.<span class="string">&quot;/vim&quot;</span></span><br><span class="line">  <span class="keyword">execute</span> <span class="string">&quot;set rtp+=&quot;</span>.<span class="variable">s:ocamlmerlin</span>.<span class="string">&quot;/vimbufsync&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:opamshare</span> = <span class="keyword">substitute</span>(<span class="built_in">system</span>(<span class="string">&#x27;opam config var share&#x27;</span>),<span class="string">&#x27;\n$&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">execute</span> <span class="string">&quot;set rtp+=&quot;</span> . <span class="variable">g:opamshare</span> . <span class="string">&quot;/merlin/vim&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">&#x27;g:neocomplcache_force_omni_patterns&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:neocomplcache_force_omni_patterns</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:neocomplcache_force_omni_patterns</span>.ocaml = <span class="string">&#x27;[^. *\t]\.\w*\|\h\w*|#&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; OCP-indent</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType ocaml <span class="keyword">execute</span> <span class="string">&quot;set rtp+=&quot;</span> . <span class="keyword">substitute</span>(<span class="built_in">system</span>(<span class="string">&#x27;opam config var share&#x27;</span>), <span class="string">&#x27;\n$&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span>) . <span class="string">&quot;/ocp-indent/vim/indent/ocaml.vim&quot;</span></span><br></pre></td></tr></table></figure>

<p>VS Code中的配置很简单，装上<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=freebroccolo.reasonml">Ocaml and Reason IDE</a>，就好了。这里面还有一个神器<a target="_blank" rel="noopener" href="https://docs.imandra.ai/imandra-docs/notebooks/installation-simple/">Imandra</a>，可以粗浅的看作是Ocaml中LiquidHaskell，而且是商业化的。</p>
<p><img src="/image/imandra.jpg" alt="Imandra IDE - Material-icon"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Aquamacs简洁的配置用来做快速的原型开发很合适。效果如下图所示，代码补全与Utop：</p>
<p><img src="/image/ocaml_utop.jpg" alt="Merlin 与 Emacs 配合"></p>
<p>Macvim/Vim更适合需要快速加载的大型项目，加载速度是emacs的痛点。效果如下图所示，Omni代码补全：</p>
<p><img src="/image/ocaml_vim.jpg" alt="Merlin 与 Vim 配合"></p>
<p>题外话：时代在不断进步，<a target="_blank" rel="noopener" href="https://spacevim.org/">SpaceVim</a>和<a target="_blank" rel="noopener" href="http://spacemacs.org/">Spacemacs</a>逐渐趋于成熟，很多主流的编程语言完全可以尝试新的开发环境。各自有各自的特点可以穿插交替使用。<a href="">Sublime Text</a>感觉已经凉了，<a href="">VS Code</a>是更好的选择，除了本身背后有微软一个团队在做（Visual Studio的技术积累），开放的社区能提供更多更快的特性支持。但是<a href="">Sublime Merge</a>横空出世，可以做为<a href="">Github Desktop</a>的代替品，相对来说<code>Git</code>或者<code>diff</code>这种单一功能的工具也许更适合一个微型团队持续维护与支持。</p>
<p>附：utop有一些<a target="_blank" rel="noopener" href="https://github.com/ocaml-community/utop/issues/258">更新</a>，可以参考这个issue</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://izhen.me/2019/05/11/ocaml_config/" data-id="cktfbroih006ct8dx7cjc8zu0" data-title="OCaml开发环境搭建" class="article-share-link">Share</a>
      
        <a href="https://izhen.me/2019/05/11/ocaml_config/#disqus_thread" class="article-comment-link">Comments</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Emacs/" rel="tag">Emacs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac-OS-X/" rel="tag">Mac OS X</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OCaml/" rel="tag">OCaml</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VS-Code/" rel="tag">VS Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vim/" rel="tag">Vim</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/imandra/" rel="tag">imandra</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/08/23/mystory1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          我的故事——竞赛篇
        
      </div>
    </a>
  
  
    <a href="/2019/05/07/opensource_creative/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MAC OS X 上可以使用的开源免费创意软件</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2009-2024 Zhen Yi<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
      <br>
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span class="site-uv">用户访问: <span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
      <span class="site-pv">本站访问: <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a target="_blank" rel="noopener" href="http://sweetpotato.ai" class="mobile-nav-link">λ</a>
  
    <a href="/lab" class="mobile-nav-link">About</a>
  
    <a target="_blank" rel="noopener" href="https://resume.izhen.me" class="mobile-nav-link">Resume</a>
  
    <a target="_blank" rel="noopener" href="https://github.com/i-zhen" class="mobile-nav-link">Github</a>
  
</nav>
    
<script>
  var disqus_shortname = 'izhen';
  
  var disqus_url = 'https://izhen.me/2019/05/11/ocaml_config/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>