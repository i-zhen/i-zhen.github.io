<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Haskell开发环境搭建 | Z.Y. ☯ Cosmos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="两年之前撰文 Haskell的Atom IDE伪装，那时刚离开英国，因为在旁听一门大一新生的函数式编程入门课时某个契机启发了主讲教授，便委托我撰写了一个配置指南。期间我们还因为依赖的安装互相通过邮件交流了很多。现在当我再次去网站上浏览时发觉atom是仅剩的指导了，说来惭愧，我现在不怎么用atom了，使用atom取代emacs并不是我的本意，至少我并不希望任何一款editor占据主导地位。">
<meta property="og:type" content="article">
<meta property="og:title" content="Haskell开发环境搭建">
<meta property="og:url" content="https://izhen.me/2018/08/10/haskell_emacs/index.html">
<meta property="og:site_name" content="Z.Y. ☯ Cosmos">
<meta property="og:description" content="两年之前撰文 Haskell的Atom IDE伪装，那时刚离开英国，因为在旁听一门大一新生的函数式编程入门课时某个契机启发了主讲教授，便委托我撰写了一个配置指南。期间我们还因为依赖的安装互相通过邮件交流了很多。现在当我再次去网站上浏览时发觉atom是仅剩的指导了，说来惭愧，我现在不怎么用atom了，使用atom取代emacs并不是我的本意，至少我并不希望任何一款editor占据主导地位。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://izhen.me/image/newemacs.jpg">
<meta property="og:image" content="https://izhen.me/image/aquamacs_haskell.png">
<meta property="og:image" content="https://izhen.me/image/aquamacs_auto.png">
<meta property="og:image" content="https://izhen.me/image/hie.jpg">
<meta property="og:image" content="https://izhen.me/image/liquid.jpg">
<meta property="article:published_time" content="2018-08-10T14:51:45.000Z">
<meta property="article:modified_time" content="2021-03-31T03:40:48.016Z">
<meta property="article:author" content="Zhen Yi">
<meta property="article:tag" content="Haskell">
<meta property="article:tag" content="Emacs">
<meta property="article:tag" content="VS Code">
<meta property="article:tag" content="Mac OS X">
<meta property="article:tag" content="IDE">
<meta property="article:tag" content="Intero">
<meta property="article:tag" content="HIE">
<meta property="article:tag" content="SSL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://izhen.me/image/newemacs.jpg">
<meta name="twitter:creator" content="@soczhenyi">
  
    <link rel="alternate" href="/atom.xml" title="Z.Y. ☯ Cosmos" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Z.Y. ☯ Cosmos</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Powered by Disqus, scientific surfing for access</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="http://sweetpotato.ai">λ</a>
        
          <a class="main-nav-link" href="/lab">About</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://resume.izhen.me">Resume</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/i-zhen">Github</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://izhen.me"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-haskell_emacs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/10/haskell_emacs/" class="article-date">
  <time class="dt-published" datetime="2018-08-10T14:51:45.000Z" itemprop="datePublished">2018-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Blog/">Blog</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Haskell开发环境搭建
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>两年之前撰文 <a href="https://izhen.me/2016/10/21/Atom-Haskell-IDE/">Haskell的Atom IDE伪装</a>，那时刚离开英国，因为在旁听一门大一新生的<a target="_blank" rel="noopener" href="https://www.inf.ed.ac.uk/teaching/courses/inf1/fp/">函数式编程入门课</a>时某个契机启发了主讲教授，便委托我撰写了一个配置指南。期间我们还因为依赖的安装互相通过邮件交流了很多。现在当我再次去网站上浏览时发觉atom是仅剩的指导了，说来惭愧，我现在不怎么用atom了，使用atom取代emacs并不是我的本意，至少我并不希望任何一款editor占据主导地位。</p>
<span id="more"></span>

<p>2020年1月补充：随着时间的推移，我从在Aquamacs上使用 <a target="_blank" rel="noopener" href="https://hackage.haskell.org/package/ghc-mod">Ghc-mod</a> 到 <a target="_blank" rel="noopener" href="https://github.com/chrisdone/intero">intero</a> 再到 <a target="_blank" rel="noopener" href="https://github.com/jyp/dante">Dante</a>，以及VS Code配合 <a target="_blank" rel="noopener" href="https://github.com/haskell/haskell-ide-engine">Haskell IDE Engine</a>，可以看出整个社区生态的一个趋势：集成度越来越高。以往我们是要将各种插件统统由自己进行组装定制。现在有了<code>LSP</code>，慢慢后端变得整齐多了。我个人是比较倾向多使用现有成熟工具体系的，有时候面对很多新锐语言只能自己组环境时才去用Vim/Emacs。对于Haskell来说，至少目前<code>HIE</code>大有前途，而且维护也很活跃，兴许用不了很久杀手级的IDE就会诞生。</p>
<p><img src="/image/newemacs.jpg" alt="Minimal Emacs for Haskell"></p>
<h3 id="做工具的主人，而不是奴隶"><a href="#做工具的主人，而不是奴隶" class="headerlink" title="做工具的主人，而不是奴隶"></a>做工具的主人，而不是奴隶</h3><p>我始终觉得工具越是开箱即用越好，曾几何时，这个赞誉属于过 <a href="">Macbook</a>。在开发工具领域，很多优质的商业化集成开发环境就是好的样本，诚然这样的工具并不是针对每一种编程语言都随处可见。不同的语言需要不同的理解和优化，好的IDE需要投入巨大的成本去开发。所以很多小众的语言依然需要我们自行配置开发环境。</p>
<h3 id="Emacs-for-Haskell"><a href="#Emacs-for-Haskell" class="headerlink" title="Emacs for Haskell"></a>Emacs for Haskell</h3><p>我只需要为Haskell做<strong>最基础</strong>的配置，尽量做一个简洁的环境出来，所以这里不选择「Spacemacs」。我这里打算使用的是 <a target="_blank" rel="noopener" href="http://aquamacs.org/">Aquamacs</a>，这是一个专门为Mac改良的Emacs，当作一个特别的发行版好了。</p>
<p>首先，我很久没有管理我之前的配置了，这次突然又折腾一遍是因为我买了台新的「Macbook Pro 15’」，我习惯第一时间先折腾环境。</p>
<p>然后我开始了「吃苦」的旅程。</p>
<h4 id="Brew"><a href="#Brew" class="headerlink" title="Brew"></a>Brew</h4><p>不知道是<code>GFW</code>的原因还是被<code>M$</code>收购的原因，不在终端配个<code>export ALL_PROXY</code>都连不上<code>Github</code>。</p>
<h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><p>Stack的官方软件源实在是不能用，我换了清华的源后好多了。有了Stack当然能方便不少，但是呢，老问题来了，我16年的时候开发网站就遇到过的：版本兼容。有些包还是不能在每一个resolver里面都有，我的办法是找不到的用<code>cabal install</code>，除此外别无他法。</p>
<h4 id="Emacs"><a href="#Emacs" class="headerlink" title="Emacs"></a>Emacs</h4><p>这个槽点就多了，首先在某个版本后，把什么gnutls的插件取消了，然后我不得不疯狂Goolge：自己搞了个SSL，然后配置上了。接着呢，在Melpa中很多插件在网站列表里有，但是我本地怎么都拉不到（flycheck），<del>所幸遇到神器intero，不然我可能就要用一个简陋版本了</del>，解决办法是切换到清华的源，现在我已经弃用intero了，直接用Dante组装出一个最小化的版本，Dante的优势是无需安装Haskell依赖。注意使用代码补全的时候，有时候要等待TAGS文件准备好，Catalina这一版系统跑Emacs确实比较慢。</p>
<h3 id="完整的配置文档"><a href="#完整的配置文档" class="headerlink" title="完整的配置文档"></a>完整的配置文档</h3><p>先装依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ brew install gnutls libressl</span><br><span class="line">$ stack install happy apply-refact hlint stylish-haskell hasktags hoogle</span><br><span class="line">$ git <span class="built_in">clone</span> --recursive git@github.com:ucsd-progsys/liquidhaskell.git </span><br><span class="line">$ <span class="built_in">cd</span> liquidhaskell</span><br><span class="line">$ stack install <span class="comment">#还需要装Z3 SMT Solver，具体看官方指南</span></span><br></pre></td></tr></table></figure>

<p>而后是配置文档（<a target="_blank" rel="noopener" href="https://github.com/i-zhen/dot-vimrc-emacs/blob/master/.emacs">完整</a>见此），快捷键配置需参考注释，常用如下：</p>
<ul>
<li><code>C-c C-l</code> 打开repl</li>
<li><code>C-c h</code> Hoogle</li>
<li><code>M-x speedbar</code> 打开speedbar</li>
<li><code>C-c r</code> 接受hlint光标所在位置的建议，自动重构</li>
<li><code>C-c b</code> 接受hlint全局的建议，自动重构</li>
<li><code>M-s M-s</code> stack mode</li>
<li><code>M-.</code> 跳转到定义（需先保存文件，保存文件会自动触发tags和stylish）</li>
<li><code>M-?</code> 跳转到使用</li>
<li><code>liquid /path/to/file.hs</code> 在VS Code配合HIE使用，或Emacs/Vim执行Unix终端命令</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; stack install happy apply-refact hlint stylish-haskell hasktags hoogle</span></span><br><span class="line"><span class="comment">;; for SSL issue: https://github.com/davidswelt/aquamacs-emacs/issues/133</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; M-x speedbar</span></span><br><span class="line">(<span class="name">require</span> &#x27;speedbar)</span><br><span class="line">(<span class="name">speedbar-add-supported-extension</span> <span class="string">&quot;.hs&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Prerequisite - begin</span></span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> hlint-refactor-call-process-region-checked (<span class="name">start</span> end program <span class="symbol">&amp;optional</span> args)</span><br><span class="line">  <span class="string">&quot;Send text from START to END to PROGRAM with ARGS.</span></span><br><span class="line"><span class="string">This is a wrapper around `call-process-region&#x27; that doesn&#x27;t replace</span></span><br><span class="line"><span class="string">the region with the output of PROGRAM if it returned a non-zero</span></span><br><span class="line"><span class="string">exit code.&quot;</span></span><br><span class="line">  (<span class="name">let</span> ((<span class="name">exit</span> (<span class="name">apply</span> &#x27;call-process-region</span><br><span class="line">                     start end</span><br><span class="line">                     program            <span class="comment">; name of program</span></span><br><span class="line">                     <span class="literal">t</span>                  <span class="comment">; delete region</span></span><br><span class="line">                     <span class="literal">t</span>                  <span class="comment">; send output to buffer</span></span><br><span class="line">                     <span class="literal">nil</span>                <span class="comment">; no redisplay during output</span></span><br><span class="line">                     args</span><br><span class="line">                     )))</span><br><span class="line">    (<span class="name">unless</span> (<span class="name">eq</span> exit <span class="number">0</span>) (<span class="name">primitive-undo</span> <span class="number">1</span> buffer-undo-list))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> hlint-refactor-call-process-region-preserve-point (<span class="name">start</span> end program <span class="symbol">&amp;optional</span> args)</span><br><span class="line">  <span class="string">&quot;Send text from START to END to PROGRAM with ARGS preserving the point.</span></span><br><span class="line"><span class="string">This uses `call-process-region-checked&#x27; internally.&quot;</span></span><br><span class="line">  (<span class="name">let</span> ((<span class="name">line</span> (<span class="name">line-number-at-pos</span>))</span><br><span class="line">        (<span class="name">column</span> (<span class="name">current-column</span>)))</span><br><span class="line">    (<span class="name">hlint-refactor-call-process-region-checked</span> start end program args)</span><br><span class="line">    (<span class="name">goto-line</span> line)</span><br><span class="line">    (<span class="name">move-to-column</span> column)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;;###autoload</span></span><br><span class="line">(<span class="name">defun</span> hlint-refactor-refactor-buffer (<span class="name">&amp;optional</span> args)</span><br><span class="line">  <span class="string">&quot;Apply all hlint suggestions in the current buffer.</span></span><br><span class="line"><span class="string">ARGS specifies additional arguments that are passed to hlint.&quot;</span></span><br><span class="line">  (<span class="name">interactive</span>)</span><br><span class="line">  (<span class="name">hlint-refactor-call-process-region-preserve-point</span></span><br><span class="line">   (<span class="name">point-min</span>)</span><br><span class="line">   (<span class="name">point-max</span>)</span><br><span class="line">   <span class="string">&quot;hlint&quot;</span></span><br><span class="line">   (<span class="name">append</span> &#x27;(<span class="string">&quot;--refactor&quot;</span></span><br><span class="line">             <span class="string">&quot;-&quot;</span>)</span><br><span class="line">           args)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;;###autoload</span></span><br><span class="line">(<span class="name">defun</span> hlint-refactor-refactor-at-point ()</span><br><span class="line">  <span class="string">&quot;Apply the hlint suggestion at point.&quot;</span></span><br><span class="line">  (<span class="name">interactive</span>)</span><br><span class="line">  (<span class="name">let</span> ((<span class="name">col</span> (<span class="name">number-to-string</span> (<span class="name">+</span> <span class="number">1</span> (<span class="name">current-column</span>))))</span><br><span class="line">        (<span class="name">line</span> (<span class="name">number-to-string</span> (<span class="name">line-number-at-pos</span>))))</span><br><span class="line">    (<span class="name">hlint-refactor-refactor-buffer</span></span><br><span class="line">     (<span class="name">list</span> (<span class="name">concat</span> <span class="string">&quot;--refactor-options=--pos &quot;</span> line <span class="string">&quot;,&quot;</span> col)))))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;;###autoload</span></span><br><span class="line">(<span class="name">define-minor-mode</span> hlint-refactor-mode</span><br><span class="line">  <span class="string">&quot;Automatically apply hlint suggestions&quot;</span></span><br><span class="line">  <span class="symbol">:lighter</span> <span class="string">&quot; hlint-refactor&quot;</span></span><br><span class="line">  <span class="symbol">:keymap</span> (<span class="name">let</span> ((<span class="name">map</span> (<span class="name">make-sparse-keymap</span>)))</span><br><span class="line">            (<span class="name">define-key</span> map <span class="string">&quot;\C-cb&quot;</span> &#x27;hlint-refactor-refactor-buffer)</span><br><span class="line">            (<span class="name">define-key</span> map <span class="string">&quot;\C-cr&quot;</span> &#x27;hlint-refactor-refactor-at-point)</span><br><span class="line">            map))</span><br><span class="line"></span><br><span class="line">(<span class="name">provide</span> &#x27;hlint-refactor)</span><br><span class="line"></span><br><span class="line"><span class="comment">;;Pre - end</span></span><br><span class="line"></span><br><span class="line">(<span class="name">package-install</span> &#x27;exec-path-from-shell)</span><br><span class="line">(<span class="name">exec-path-from-shell-initialize</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">defvar</span> prelude-packages</span><br><span class="line">  &#x27;(haskell-mode)</span><br><span class="line">  <span class="string">&quot;A list of packages to ensure are installed at launch.&quot;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> prelude-packages-installed-p ()</span><br><span class="line">  (<span class="name">loop</span> for p in prelude-packages</span><br><span class="line">        when (<span class="name">not</span> (<span class="name">package-installed-p</span> p)) do (<span class="name">return</span> <span class="literal">nil</span>)</span><br><span class="line">        finally (<span class="name">return</span> <span class="literal">t</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">if</span> (<span class="name">version&lt;=</span> <span class="string">&quot;24.0&quot;</span> emacs-version)</span><br><span class="line">    (<span class="name">unless</span> (<span class="name">prelude-packages-installed-p</span>)</span><br><span class="line">      <span class="comment">;; check for new packages (package versions)</span></span><br><span class="line">      (<span class="name">message</span> <span class="string">&quot;%s&quot;</span> <span class="string">&quot;Emacs Prelude is now refreshing its package database...&quot;</span>)</span><br><span class="line">      (<span class="name">package-refresh-contents</span>)</span><br><span class="line">      (<span class="name">message</span> <span class="string">&quot;%s&quot;</span> <span class="string">&quot; done.&quot;</span>)</span><br><span class="line">      <span class="comment">;; install the missing packages</span></span><br><span class="line">      (<span class="name">dolist</span> (<span class="name">p</span> prelude-packages)</span><br><span class="line">        (<span class="name">when</span> (<span class="name">not</span> (<span class="name">package-installed-p</span> p))</span><br><span class="line">          (<span class="name">package-install</span> p)))))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Haskell</span></span><br><span class="line">(<span class="name">package-install</span> &#x27;flycheck-color-mode-line)</span><br><span class="line">(<span class="name">package-install</span> &#x27;flycheck-pos-tip)</span><br><span class="line">(<span class="name">package-install</span> &#x27;dante)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; COMPLETION</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; (add-hook &#x27;after-init-hook &#x27;global-company-mode)</span></span><br><span class="line"><span class="comment">;shortcut for completion</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c w&quot;</span>) &#x27;company-complete)</span><br><span class="line"></span><br><span class="line"><span class="comment">;after how many letters do we want to get completion tips? 1 means from the first letter</span></span><br><span class="line">(<span class="name">setq</span> company-minimum-prefix-length <span class="number">1</span>)</span><br><span class="line">(<span class="name">setq</span> company-dabbrev-downcase <span class="number">0</span>)</span><br><span class="line"><span class="comment">;after how long of no keys should we get the completion tips? in seconds</span></span><br><span class="line">(<span class="name">setq</span> company-idle-delay <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ERRORS ON THE FLY</span></span><br><span class="line"></span><br><span class="line">(<span class="name">require</span> &#x27;flycheck)</span><br><span class="line"><span class="comment">;; (add-hook &#x27;after-init-hook &#x27;global-flycheck-mode)</span></span><br><span class="line">(<span class="name">require</span> &#x27;flycheck-color-mode-line)</span><br><span class="line"></span><br><span class="line"><span class="comment">;tooltip errors</span></span><br><span class="line">(<span class="name">require</span> &#x27;flycheck-pos-tip)</span><br><span class="line">(<span class="name">with-eval-after-load</span> &#x27;flycheck</span><br><span class="line">  (<span class="name">flycheck-pos-tip-mode</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> flycheck-pos-tip-timeout <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">with-eval-after-load</span> &#x27;flycheck</span><br><span class="line">  (<span class="name">setq-default</span> flycheck-disabled-checkers &#x27;(emacs-lisp-checkdoc)))</span><br><span class="line"></span><br><span class="line">(<span class="name">require</span> &#x27;flycheck-color-mode-line)</span><br><span class="line">(<span class="name">add-hook</span> &#x27;flycheck-mode-hook</span><br><span class="line">  &#x27;flycheck-color-mode-line-mode)</span><br><span class="line"></span><br><span class="line">(<span class="name">global-set-key</span> [f9] &#x27;flycheck-list-errors)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="name">package-install</span> &#x27;flymake-hlint)</span><br><span class="line">(<span class="name">require</span> &#x27;flymake-hlint)</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my-haskell-hook ()</span><br><span class="line">  (<span class="name">progn</span></span><br><span class="line">    (<span class="name">hlint-refactor-mode</span>)</span><br><span class="line">    (<span class="name">interactive-haskell-mode</span>)</span><br><span class="line">    (<span class="name">haskell-doc-mode</span>)</span><br><span class="line">    (<span class="name">haskell-indentation-mode</span>)</span><br><span class="line">	(<span class="name">dante-mode</span>)</span><br><span class="line">	(<span class="name">flycheck-mode</span>)</span><br><span class="line">	(<span class="name">flymake-hlint-load</span>)</span><br><span class="line">	(<span class="name">company-mode</span>)</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line">(<span class="name">add-hook</span> &#x27;haskell-mode-hook &#x27;my-haskell-hook)</span><br><span class="line">(<span class="name">setq</span> dante-repl-command-line &#x27;(<span class="string">&quot;stack&quot;</span> <span class="string">&quot;repl&quot;</span> dante-target))</span><br><span class="line"><span class="comment">;; Put following line in your project: .dir-locals.el</span></span><br><span class="line"><span class="comment">;; ((nil . ((dante-methods . (stack)))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; (setq flycheck-check-syntax-automatically &#x27;(save mode-enabled))</span></span><br><span class="line"><span class="comment">;; (add-hook &#x27;dante-mode-hook</span></span><br><span class="line"><span class="comment">;;   &#x27;(lambda () (flycheck-add-next-checker &#x27;haskell-dante</span></span><br><span class="line"><span class="comment">;;                &#x27;(warning . haskell-hlint))))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; install stack mode with shortcut: Alt-s Alt-s</span></span><br><span class="line">(<span class="name">package-install</span> &#x27;hasky-stack)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-s M-s&quot;</span>) #&#x27;hasky-stack-execute)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; use Shift-arrow keys to move between windows</span></span><br><span class="line">(<span class="name">windmove-default-keybindings</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">require</span> &#x27;haskell-mode)</span><br><span class="line">(<span class="name">define-key</span> haskell-mode-map <span class="string">&quot;\C-ch&quot;</span> &#x27;haskell-hoogle)</span><br><span class="line"><span class="comment">;(setq haskell-hoogle-command &quot;hoogle&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; use M-. on a name in a Haskell buffer which will jump directly to its definition</span></span><br><span class="line">(<span class="name">setq</span> haskell-tags-on-save <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">custom-set-variables</span></span><br><span class="line"> <span class="comment">;; custom-set-variables was added by Custom.</span></span><br><span class="line"> <span class="comment">;; If you edit it by hand, you could mess it up, so be careful.</span></span><br><span class="line"> <span class="comment">;; Your init file should contain only one such instance.</span></span><br><span class="line"> <span class="comment">;; If there is more than one, they won&#x27;t work right.</span></span><br><span class="line"> &#x27;(haskell-stylish-on-save t)</span><br><span class="line"> &#x27;(package-selected-packages</span><br><span class="line">   (quote</span><br><span class="line">    (auto-complete merlin utop tuareg hasky-stack exec-path-from-shell haskell-mode flycheck company))))</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>效果如下图所示，hlint代码建议：</p>
<p><img src="/image/aquamacs_haskell.png" alt="hlint 与 haskell mode 配合"></p>
<p>代码补全，有了intero可以不需要ghc-mod：</p>
<p><img src="/image/aquamacs_auto.png" alt="intero 的 autocomplete"></p>
<h3 id="2019年补充"><a href="#2019年补充" class="headerlink" title="2019年补充"></a>2019年补充</h3><p>Visual Studio Code可以说已经取代了曾经<a target="_blank" rel="noopener" href="https://atom.io/">Atom</a>的地位，而且随着生态的不断完善已经可以胜任基本的开发工作。有一种可以说「一键式」的开发环境就是利用<a target="_blank" rel="noopener" href="https://github.com/haskell/haskell-language-server">Haskell Language Server</a>搭配任意你喜欢的Editor。这里我配置了一个VS Code的环境，HIE相对来讲配置简单，可以参考官方指南。相比于我自己的配置，最明显的多了<a target="_blank" rel="noopener" href="https://github.com/alanz/HaRe">HaRe</a>和<a target="_blank" rel="noopener" href="https://ucsd-progsys.github.io/liquidhaskell-blog/">LiquidHaskell</a>两个神器，这些全部配套起来再加上<code>stack ghci</code>完全可以作为胜任生产环境的工业级的IDE。使用效果：</p>
<p><img src="/image/hie.jpg" alt="VS Code + Haskell Language Server"></p>
<p>集成LiquidHaskell做形式验证的效果：</p>
<p><img src="/image/liquid.jpg" alt="LiquidHaskell"></p>
<p>配置过程中可能遇到的<a target="_blank" rel="noopener" href="https://qiita.com/waddlaw/items/b83cd10311200095fe87">问题</a>，<strong>切记HIE需要在stack工程下才能运行，不支持plain的项目</strong>。还有需要安装<code>awk</code>通过<code>brew install awk</code>。可以配合其他VS Code的<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=hoovercj.haskell-linter">hlint</a>插件使用。 </p>
<p>附：有一款为<code>Mac</code>开发的付费App推荐：<a target="_blank" rel="noopener" href="http://haskellformac.com/">Haskell for Mac</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://izhen.me/2018/08/10/haskell_emacs/" data-id="cktfbrohz004kt8dxcjb965rf" data-title="Haskell开发环境搭建" class="article-share-link">Share</a>
      
        <a href="https://izhen.me/2018/08/10/haskell_emacs/#disqus_thread" class="article-comment-link">Comments</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Emacs/" rel="tag">Emacs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HIE/" rel="tag">HIE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Haskell/" rel="tag">Haskell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Intero/" rel="tag">Intero</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac-OS-X/" rel="tag">Mac OS X</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSL/" rel="tag">SSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VS-Code/" rel="tag">VS Code</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/20/firstsite/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          第一个网站
        
      </div>
    </a>
  
  
    <a href="/2018/07/18/parallelmerge/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">并行归并排序</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2009-2022 Zhen Yi<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
      <br>
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span class="site-uv">用户访问: <span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
      <span class="site-pv">本站访问: <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a target="_blank" rel="noopener" href="http://sweetpotato.ai" class="mobile-nav-link">λ</a>
  
    <a href="/lab" class="mobile-nav-link">About</a>
  
    <a target="_blank" rel="noopener" href="https://resume.izhen.me" class="mobile-nav-link">Resume</a>
  
    <a target="_blank" rel="noopener" href="https://github.com/i-zhen" class="mobile-nav-link">Github</a>
  
</nav>
    
<script>
  var disqus_shortname = 'izhen';
  
  var disqus_url = 'https://izhen.me/2018/08/10/haskell_emacs/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>